// ==UserScript==
// @name         ìœ ë‹ˆì½˜ ê°•ë ¥í•œ ê´‘ê³ ì°¨ë‹¨ê¸°
// @namespace    https://unicornpro.extension/
// @version      3.1
// @description  ëª¨ë“  ì›¹ì‚¬ì´íŠ¸ ê´‘ê³  ì°¨ë‹¨ + YouTube ê´‘ê³  ì™„ë²½ ì°¨ë‹¨
// @author       User
// @match        https://*/*
// @match        http://*/*
// @grant        none
// @run-at       document-start
// ==/UserScript==

(function() {
    'use strict';

    // ì¼ë°˜ ê´‘ê³  ì„ íƒìë“¤
    const adSelectors = [
        // ê¸°ë³¸ ê´‘ê³  í´ë˜ìŠ¤ë“¤
        '.ad', '.ads', '.advertisement', '.banner', '.popup', '.modal',
        '.ad-container', '.ad-wrapper', '.ad-banner', '.ad-block', '.ad-content',
        '.ad-space', '.ad-unit', '.ad-slot', '.ad-frame', '.ad-box',
        
        // Google ê´‘ê³ ë“¤
        '.google-ads', '.adsense', '.adsbygoogle', 
        'ins[class*="adsbygoogle"]', '.google-ad-unit',
        
        // í•œêµ­ ê´‘ê³  í”Œë«í¼ë“¤
        '.dable_widget', '.dable-widget', '.taboola', '.outbrain', 
        '.criteo', '.teads', '.sharethrough',
        '[class*="kakao-ad"]', '[class*="naver-ad"]', '[class*="daum-ad"]',
        '.recopick', '.mgid', '.Colombia', '.admixer',
        
        // ì†Œì…œë¯¸ë””ì–´ ê´‘ê³ 
        '[data-testid*="ad"]', '[aria-label*="ê´‘ê³ "]', '[aria-label*="Sponsored"]',
        '.promoted-tweet', '.sponsored-post',
        
        // ë¹„ë””ì˜¤ ê´‘ê³ 
        '.video-ads', '.preroll', '.midroll', '.postroll',
        '.ima-ad-container', '.html5-ad-container',
        
        // íŒì—… ê´€ë ¨
        '.overlay', '.lightbox', '.fancybox', '.colorbox',
        '[class*="popup"]', '[class*="modal"]', '[class*="overlay"]',
        
        // ë„¤ì´í‹°ë¸Œ ê´‘ê³ 
        '.native-ad', '.sponsored-content', '.promoted-content',
        '[class*="sponsored"]', '[class*="promoted"]',
        
        // iframe ê´‘ê³ ë“¤
        'iframe[src*="googleads"]', 'iframe[src*="doubleclick"]',
        'iframe[src*="googlesyndication"]', 'iframe[src*="adsystem"]',
        'iframe[src*="amazon-adsystem"]', 'iframe[src*="facebook.com/tr"]',
        
        // ID ê¸°ë°˜
        '#ad', '#ads', '#advertisement', '#banner', '#popup',
        '#google_ads', '#adsense', '#adngin',
        
        // ì†ì„± ê¸°ë°˜
        '[class*="ad-"]', '[class*="ads-"]', '[class*="banner-"]',
        '[id*="ad-"]', '[id*="ads-"]', '[id*="banner-"]',
        '[data-ad]', '[data-ads]', '[data-advertisement]'
    ];

    // ê°•ë ¥í•œ CSS ìŠ¤íƒ€ì¼ ì£¼ì…
    function injectStrongCSS() {
        const style = document.createElement('style');
        style.id = 'unicorn-ad-blocker-enhanced';
        style.textContent = `
            /* ê¸°ë³¸ ê´‘ê³  ìš”ì†Œ ì™„ì „ ì œê±° */
            .ad, .ads, .advertisement, .banner, .popup,
            .ad-container, .ad-wrapper, .ad-banner, .ad-block, .ad-content,
            .ad-space, .ad-unit, .ad-slot, .ad-frame, .ad-box,
            .google-ads, .adsense, .adsbygoogle,
            .dable_widget, .dable-widget, .taboola, .outbrain, .criteo,
            [class*="ad-"], [class*="ads-"], [class*="banner-"],
            [id*="ad-"], [id*="ads-"], [id*="banner-"],
            [class*="kakao-ad"], [class*="naver-ad"], [class*="daum-ad"],
            [data-ad], [data-ads], [data-advertisement],
            .native-ad, .sponsored-content, .promoted-content,
            [class*="sponsored"], [class*="promoted"],
            .overlay, .lightbox, .fancybox, .colorbox,
            [class*="popup"], [class*="modal"], [class*="overlay"] {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                height: 0px !important;
                width: 0px !important;
                margin: 0 !important;
                padding: 0 !important;
                position: absolute !important;
                left: -9999px !important;
                top: -9999px !important;
                z-index: -9999 !important;
            }
            
            /* iframe ê´‘ê³  ì°¨ë‹¨ */
            iframe[src*="googleads"],
            iframe[src*="doubleclick"],
            iframe[src*="googlesyndication"],
            iframe[src*="adsystem"],
            iframe[src*="amazon-adsystem"] {
                display: none !important;
            }
            
            /* ë¹„ë””ì˜¤ ê´‘ê³  ì°¨ë‹¨ */
            .video-ads, .preroll, .midroll, .postroll,
            .ima-ad-container, .html5-ad-container {
                display: none !important;
            }
            
            /* ì†Œì…œë¯¸ë””ì–´ ê´‘ê³  ì°¨ë‹¨ */
            [data-testid*="ad"], [aria-label*="ê´‘ê³ "], [aria-label*="Sponsored"] {
                display: none !important;
            }
            
            /* YouTube ì „ìš© ê´‘ê³  ì°¨ë‹¨ */
            .ytp-ad-overlay-container,
            .ytp-ad-text-overlay,
            .ytp-ad-player-overlay-instream-info,
            .ytp-ad-overlay-close-button,
            .ytp-ad-skip-button-container,
            .ytp-ad-image-overlay,
            .ytp-ad-text,
            .ytp-ad-preview-container,
            .ad-interrupting,
            .ad-showing,
            [class*="masthead-ad"],
            [id*="player-ads"],
            ytd-display-ad-renderer,
            ytd-promoted-sparkles-web-renderer,
            ytd-ad-slot-renderer,
            ytd-in-feed-ad-layout-renderer,
            ytd-banner-promo-renderer,
            .ytd-promoted-video-renderer,
            .ytd-compact-promoted-video-renderer {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                height: 0 !important;
                width: 0 !important;
            }
            
            /* íŒì—… ì°¨ë‹¨ */
            [class*="adshield"], [id*="adshield"] {
                display: none !important;
            }
        `;
        
        if (!document.head) {
            document.head = document.createElement('head');
            document.documentElement.appendChild(document.head);
        }
        
        document.head.appendChild(style);
    }

    // ì¼ë°˜ ê´‘ê³  ì œê±°
    function removeAdsAggressively() {
        let removedCount = 0;
        
        adSelectors.forEach(selector => {
            try {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (element && element.parentNode) {
                        element.remove();
                        removedCount++;
                    }
                });
            } catch (e) {
                // ì„ íƒì ì˜¤ë¥˜ ë¬´ì‹œ
            }
        });
        
        if (removedCount > 0) {
            console.log(`ğŸš« ${removedCount}ê°œ ì¼ë°˜ ê´‘ê³  ì°¨ë‹¨`);
        }
    }

    // íŒì—… ì°¨ë‹¨
    function blockPopups() {
        window.alert = function() { return false; };
        window.confirm = function() { return false; };
        window.prompt = function() { return ''; };
        
        let userInteracted = false;
        document.addEventListener('click', () => { userInteracted = true; });
        document.addEventListener('keydown', () => { userInteracted = true; });
        
        const originalOpen = window.open;
        window.open = function(url) {
            if (!userInteracted) {
                console.log('ğŸš« ìë™ íŒì—… ì°¨ë‹¨:', url);
                return null;
            }
            userInteracted = false;
            return originalOpen.apply(window, arguments);
        };
    }

    // YouTube ê´‘ê³  ì™„ë²½ ì°¨ë‹¨
    function handleYouTubeAds() {
        if (!window.location.hostname.includes('youtube.com')) return;
        
        console.log('ğŸ¥ YouTube ê´‘ê³  ì°¨ë‹¨ ì‹œì‘');
        
        // ê´‘ê³  ìŠ¤í‚µ ë²„íŠ¼ ìë™ í´ë¦­
        function autoSkipAds() {
            const skipButtons = [
                '.ytp-ad-skip-button',
                '.ytp-skip-ad-button', 
                '.ytp-ad-skip-button-modern',
                '.ytp-ad-overlay-close-button',
                '[aria-label*="ê´‘ê³  ê±´ë„ˆë›°ê¸°"]',
                '[aria-label*="Skip ad"]',
                '.ytp-ad-skip-button-container button'
            ];
            
            skipButtons.forEach(selector => {
                const button = document.querySelector(selector);
                if (button && button.style.display !== 'none') {
                    button.click();
                    console.log('ğŸš« YouTube ê´‘ê³  ìŠ¤í‚µ ë²„íŠ¼ í´ë¦­');
                }
            });
        }
        
        // ê´‘ê³  ê´€ë ¨ ìš”ì†Œ ì œê±°
        function removeYouTubeAdElements() {
            const youtubeAdSelectors = [
                '.ytp-ad-overlay-container',
                '.ytp-ad-text-overlay',
                '.ytp-ad-player-overlay-instream-info',
                '.ytp-ad-image-overlay',
                '.ytp-ad-text',
                '.ytp-ad-preview-container',
                '.ad-interrupting',
                '.ad-showing',
                'ytd-display-ad-renderer',
                'ytd-promoted-sparkles-web-renderer',
                'ytd-ad-slot-renderer',
                'ytd-in-feed-ad-layout-renderer',
                'ytd-banner-promo-renderer',
                '.ytd-promoted-video-renderer',
                '.ytd-compact-promoted-video-renderer',
                '[class*="masthead-ad"]',
                '[id*="player-ads"]'
            ];
            
            let removedCount = 0;
            youtubeAdSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (element) {
                        element.remove();
                        removedCount++;
                    }
                });
            });
            
            if (removedCount > 0) {
                console.log(`ğŸš« YouTube ê´‘ê³  ìš”ì†Œ ${removedCount}ê°œ ì œê±°`);
            }
        }
        
        // ë¹„ë””ì˜¤ ê´‘ê³  ìë™ ìŠ¤í‚µ (ì‹œê°„ ì¡°ì‘)
        function autoSkipVideoAds() {
            const video = document.querySelector('video');
            if (video) {
                const adIndicators = [
                    document.querySelector('.ytp-ad-text'),
                    document.querySelector('.ad-showing'),
                    document.querySelector('.ad-interrupting')
                ];
                
                const hasAd = adIndicators.some(indicator => indicator && indicator.style.display !== 'none');
                
                if (hasAd && video.duration > 0 && video.currentTime < video.duration) {
                    video.currentTime = video.duration - 0.1;
                    console.log('ğŸš« YouTube ê´‘ê³  ì‹œê°„ ìŠ¤í‚µ');
                }
            }
        }
        
        // YouTube Premium íŒì—… ì°¨ë‹¨
        function blockPremiumPopups() {
            const premiumSelectors = [
                'ytd-mealbar-promo-renderer',
                'ytd-popup-container',
                '[aria-label*="Premium"]',
                '[class*="premium"]'
            ];
            
            premiumSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (element && element.textContent.includes('Premium')) {
                        element.remove();
                    }
                });
            });
        }
        
        // 0.5ì´ˆë§ˆë‹¤ ì‹¤í–‰
        setInterval(() => {
            autoSkipAds();
            removeYouTubeAdElements();
            autoSkipVideoAds();
            blockPremiumPopups();
        }, 500);
        
        // ë¹„ë””ì˜¤ ì‹œì‘/ì¼ì‹œì •ì§€ ì‹œì—ë„ ì‹¤í–‰
        document.addEventListener('play', autoSkipAds, true);
        document.addEventListener('loadstart', autoSkipAds, true);
    }

    // DOM ë³€í™” ê°ì§€
    function setupMutationObserver() {
        const observer = new MutationObserver(function(mutations) {
            let shouldCheck = false;
            
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                    shouldCheck = true;
                }
            });
            
            if (shouldCheck) {
                clearTimeout(window.adBlockTimeout);
                window.adBlockTimeout = setTimeout(() => {
                    removeAdsAggressively();
                }, 100);
            }
        });

        if (document.body) {
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        } else {
            setTimeout(setupMutationObserver, 100);
        }
    }

    // ì´ˆê¸°í™” í•¨ìˆ˜
    function init() {
        try {
            console.log('ğŸš« ìœ ë‹ˆì½˜ ê°•ë ¥í•œ ê´‘ê³ ì°¨ë‹¨ê¸° ì‹œì‘!');
            
            // ì¦‰ì‹œ CSS ì£¼ì…
            injectStrongCSS();
            
            // íŒì—… ì°¨ë‹¨
            blockPopups();
            
            // ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
            removeAdsAggressively();
            
            // DOM ì¤€ë¹„ í›„ ì‹¤í–‰
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    removeAdsAggressively();
                    setupMutationObserver();
                    handleYouTubeAds();
                });
            } else {
                removeAdsAggressively();
                setupMutationObserver();
                handleYouTubeAds();
            }
            
            // ì£¼ê¸°ì  ê²€ì‚¬
            setInterval(removeAdsAggressively, 3000); // 3ì´ˆë§ˆë‹¤
            
            // ìŠ¤í¬ë¡¤ ì‹œì—ë„ ê²€ì‚¬
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(removeAdsAggressively, 500);
            });
            
        } catch (error) {
            console.error('ê´‘ê³ ì°¨ë‹¨ê¸° ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        }
    }

    // ì¦‰ì‹œ ì‹¤í–‰
    init();

})();
